# Проектная работа "Веб-ларёк"

## Используемый стек: HTML, SCSS, TypeScript, Webpack

## Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или
 
```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект реализует архитектуру MVP (Model-View-Presenter), где:

- **Model (модель)**:
  - Отвечает за хранение и управление данными.
  - Включает классы `AppState`, `Item`, `Order`, `Contacts`.
  - Данные передаются через события, например, `basket:changed` или `item:selected`.

- **View (представление)**:
  - Отвечает за отображение данных пользователю.
  - Включает классы `Page`, `Card`, `Basket`, `Modal`, `Success`.
  - Взаимодействует с пользователем и передает события в `Presenter`.

- **Presenter (презентер)**:
  - Связывает `Model` и `View`.
  - Обрабатывает события от `View` и обновляет `Model`.
  - Управляет логикой приложения, например, добавлением товаров в корзину или оформлением заказа.
  - 
### Взаимодействие компонентов
- Пользователь взаимодействует с `View` (например, нажимает на кнопку "Купить").
- `View` отправляет событие в `Presenter`.
- `Presenter` обновляет `Model` (например, добавляет товар в корзину).
- `Model` отправляет событие об изменении данных.
- `View` обновляет интерфейс на основе новых данных.

## Типы данных

- **Product**: Описывает товар, включая его идентификатор, название, описание, изображение, категорию и цену.
- **Order**: Описывает заказ, включая адрес доставки, способ оплаты, контактные данные и список товаров.
- **AppState**: Хранит текущее состояние приложения, включая каталог товаров, корзину и данные заказа.

### Главная страница

- **Список товаров:**  
  На стартовой странице отображается динамически загружаемый с сервера перечень товаров.

- **Индикатор корзины:**  
  Кнопка корзины оснащена счётчиком, который показывает общее количество добавленных товаров.

- **Модальные окна:**  
  Два модальных окна реализованы для:
  - Детального просмотра информации о товаре.
  - Отображения содержимого корзины.  
  Оба окна закрываются при клике вне их области или при нажатии на кнопку закрытия (крестик).

### Карточка товара

- **Полная информация:**  
  Отображается полное описание выбранного товара.

- **Добавление в корзину:**  
  В модальном окне, при нажатии на кнопку «Купить», товар добавляется в корзину.

### Корзина

- **Содержимое корзины:**  
  В модальном окне выводится список товаров, добавленных в корзину, с указанием названий и цен.

- **Удаление товара:**  
  При клике на кнопку удаления соответствующий товар убирается из корзины, после чего автоматически пересчитываются:
  - Общая стоимость заказа.
  - Количество товаров, отображаемое на кнопке корзины.

- **Оформление заказа:**  
  Нажатие на активную кнопку «Оформить» открывает модальное окно для выбора способа оплаты и ввода адреса доставки.

### Оформление заказа

- **Выбор способа оплаты:**  
  При нажатии на кнопку «Далее» пользователь выбирает способ оплаты.

- **Валидация формы:**  
  Реализована проверка корректности заполнения формы (валидация).

### Завершение заказа

- **Отправка запроса:**  
  При нажатии на кнопку оплаты происходит отправка запроса на сервер.

- **Очистка корзины:**  
  После успешного выполнения запроса:
  - Корзина очищается.
  - Сбрасывается счётчик товаров на кнопке корзины.
  - Открывается модальное окно с подтверждением успешного оформления заказа.

## Базовые компоненты кода

### Класс EventEmitter

Класс **EventEmitter** реализует механизм управления событиями, позволяя:

- **Регистрировать** обработчики для заданных событий.
- **Удалять** зарегистрированные обработчики.
- **Инициировать** события с передачей данных.
- **Подписываться** на все события сразу.
- **Управлять** подписками с помощью функции-триггера.

### Свойства

**_events: Map<EventName, Set<Subscriber>>**  
  Хранит список событий и соответствующих им подписчиков. Каждое событие сопоставлено с набором функций-обработчиков.

### Конструктор

 **constructor()**  
  Инициализирует `_events` как новую карту (`Map`), предназначенную для управления подписками на события.

### Методы

### on<T extends object>(eventName: EventName, callback: (event: T) => void)

- **Назначение:** Регистрирует обработчик для указанного события.
- **Аргументы:**
    - `eventName`: Имя события, на которое подписываются.
    - `callback`: Функция-обработчик, которая будет вызвана при наступлении события.
- **Поведение:**  
  Если событие еще не зарегистрировано в `_events`, создается новая запись с пустым набором подписчиков. Затем указанный
  `callback` добавляется в набор обработчиков для этого события.

---

### off(eventName: EventName, callback: Subscriber)

- **Назначение:** Удаляет обработчик для заданного события.
- **Аргументы:**
    - `eventName`: Имя события.
    - `callback`: Функция-обработчик, которую необходимо удалить.
- **Поведение:**  
  Если событие существует, удаляется указанный `callback` из набора подписчиков. При отсутствии оставшихся подписчиков
  запись о событии удаляется из карты.

---

### emit<T extends object>(eventName: string, data?: T)

- **Назначение:** Инициирует событие, вызывая все зарегистрированные обработчики.
- **Аргументы:**
    - `eventName`: Имя события, которое следует инициировать.
    - `data` (необязательный): Дополнительные данные, передаваемые обработчикам.
- **Поведение:**  
  Метод перебирает все события в `_events` и выполняет следующие действия:
    - Если событие имеет имя `"*"` (универсальный обработчик), вызываются все его обработчики с объектом, содержащим
      `eventName` и `data`.
    - Если имя события соответствует непосредственно `eventName` или удовлетворяет регулярному выражению, обработчики
      вызываются с переданными данными.

---

### onAll(callback: (event: EmitterEvent) => void)

- **Назначение:** Регистрирует обработчик, который будет вызван для любого события.
- **Аргументы:**
    - `callback`: Функция, обрабатывающая любое событие.
- **Поведение:**  
  Фактически, этот метод добавляет обработчик под именем `"*"`, что позволяет перехватывать все события.

---

### offAll()

- **Назначение:** Удаляет все зарегистрированные обработчики событий.
- **Поведение:**  
  Метод сбрасывает `_events`, создавая новую пустую карту, что приводит к полной очистке всех подписок.

---

### trigger<T extends object>(eventName: string, context?: Partial<T>)

- **Назначение:** Возвращает функцию, которая при вызове инициирует заданное событие.
- **Аргументы:**
    - `eventName`: Имя события, которое будет инициировано.
    - `context` (необязательный): Дополнительный контекст или данные, которые будут объединены с данными события.
- **Поведение:**  
  Возвращает функцию, которая при вызове объединяет переданные данные и инициирует событие через метод `emit`.

---

### Абстрактный класс Model<T>

Этот класс является основой для всех моделей данных. Он принимает тип T и интегрирован с EventEmitter, что позволяет
оповещать другие слои приложения об изменениях через метод emitChanges.
Абстрактный класс Component<T>
 - **Свойства**: protected readonly component: HTMLElement — корневой DOM-элемент

- **Конструктор**: constructor(data:Partial, events: IEvenets) — принимает начальный данные для модели и объект событий
  для уведомления об изменениях в модели.

- **Методы**:

  `emitChanges(event: string, payload?: object)` — запускает событие с переданным названием и данными, уведомляя
  подписчиков в изменении модели

### Абстрактный класс Form<T>

Является базой для всех форм в приложении. Содержит:

    метод valid для управления активностью кнопки отправки,
    метод errors для вывода сообщений об ошибках.
    абстрактный метод cleanFieldValues для очистки значений полей формы.


### Класс Api

Реализует обмен данными с сервером посредством HTTP-запросов с использованием методов *GET* и *POST*.
Основные классы и функциональные блоки
Модели данных

### Класс AppAPI

Класс предоставляет методы взаимодействия с бэкендом. Конструктор принимает инстант класса API.. Содержит:

    метод getItemList для получения списка товаров,
    метод postOrder для отправки заказа.

Оба метода принимают относительный URL и данные, необходимые для запроса.
Событийная модель приложения

### Класс Item

Отвечает за представление карточки товара. В его обязанности входит отображение идентификатора, названия, описания,
изображения, категории и цены продукта.
Класс AppState

Хранит текущее состояние приложения, включая:

    данные заказа,
    список товаров каталога,
    содержимое корзины,
    состояния форм заказа и контактов.

Основные методы:

    addBasket — добавление товара в корзину;
    deleteBasket — удаление товара из корзины;
    setCatalog — обновление списка товаров;
    getNumberBasket — получение количества товаров в корзине;
    getTotalBasket — вычисление итоговой стоимости корзины;
    isInBasket — проверка наличия товара в корзине;
    validate — проверка корректности заполнения форм;
    prepareOrder — подготовка заказа для отправки на сервер;
    cleanBasketState и cleanOrder — очистка данных после успешного оформления.

### Компоненты интерфейса

### Класс Page

Отвечает за управление общей страницей. Предоставляет возможность:

    устанавливать счётчик для корзины,
    рендерить список карточек каталога,
    блокировать страницу через сеттер locked при открытии модальных окон.

### Класс Card

Позволяет отображать подробное описание товара. Содержит методы для установки следующих полей:

    идентификатор,
    заголовок,
    изображение,
    категория,
    цена,
    описание.

Также имеет индикатор isInBasket для обозначения наличия товара в корзине. Метод getCategoryClass помогает установить
соответствующий цвет для категории. В конструктор передаётся функция onClick для обработки кликов по карточке или
кнопке.
Класс Basket

Реализует функциональность корзины:

    отображение списка товаров,
    расчёт и установку общей суммы (total),
    метод disableButton для блокировки кнопки при отсутствии оплачиваемых товаров.


#### Класс Order

Наследуется от базового класса Form и управляет формой оформления заказа. Обеспечивает установку адреса и способа оплаты
через соответствующие сеттеры. Метод cleanFieldValues очищает данные формы заказа.

#### Класс Contacts

Специализирован для ввода контактных данных. Предоставляет сеттеры для полей email и телефона. Метод cleanFieldValues
отвечает за сброс введённых данных.
#### Класс Success

Отображает уведомление об успешном оформлении заказа. Содержит сеттер для итоговой суммы (total). По клику на кнопку «За
новыми покупками!» происходит закрытие модального окна и очистка данных корзины и заказа.
#### Класс Modal

Отвечает за работу с модальными окнами. Включает методы:

    open — открытие модального окна,
    close — его закрытие.

### Список событий
#### События изменения данных
Создаются классами моделей.
- `basket:changed` - изменение количества товаров корзины;
- `userData:changed` - изменение данных пользователя;
- `item:selected` - добавление товара в корзину;